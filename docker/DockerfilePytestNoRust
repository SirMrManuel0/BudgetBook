FROM python:3.13-slim AS final

WORKDIR /app



# Copy other project files if needed
COPY ../.. .

ARG TARGETARCH
RUN if [ "$TARGETARCH" = "arm64" ]; then \
        pip install prebuilt/wheel/mfence-0.1.1-cp313-cp313-manylinux_2_34_aarch64.whl ; \
    else \
        pip install prebuilt/wheel/mfence-0.1.1-cp313-cp313-manylinux_2_34_x86_64.whl ; \
    fi

RUN pip install -r requirements.txt

#CMD ["python", "main.py"]

RUN pip install pytest

CMD ["pytest"]
